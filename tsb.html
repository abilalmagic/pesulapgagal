<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Futuristic Quotation App v2.1</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf-autotable.min.js"></script>

    <style>
        :root {
            --primary-color: #00a8ff; /* Biru Neon */
            --secondary-color: #9c88ff; /* Ungu Lembut */
            --danger-color: #fbc531; /* Kuning */
            --bg-dark: #1f2739; /* Background utama */
            --bg-light: #2c3a47; /* Background container */
            --text-color: #e0e0e0; /* Teks */
            --border-color: rgba(0, 168, 255, 0.2);
        }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-dark);
            color: var(--text-color);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 900px;
            margin: auto;
            background: var(--bg-light);
            padding: 30px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
        }

        h2 {
            font-weight: 600;
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-bottom: 25px;
            letter-spacing: 0.5px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 0.9em;
            color: var(--secondary-color);
        }

        input, select {
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1em;
            background-color: var(--bg-dark);
            color: var(--text-color);
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s ease;
        }
        
        input[readonly] {
            background-color: #2a3341;
            cursor: not-allowed;
        }

        input:focus, select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 10px rgba(0, 168, 255, 0.4);
            outline: none;
        }
        
        input::placeholder {
            color: #6a737f;
        }

        .price-display {
            background-color: rgba(0, 168, 255, 0.1);
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
            font-weight: 600;
            text-align: center;
        }
        
        .input-group {
            display: flex;
            align-items: center;
        }

        .input-group input {
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
            border-right: none;
        }

        .input-group-text {
            padding: 12px;
            background-color: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            font-weight: 600;
            color: var(--primary-color);
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s ease;
        }
        
        .btn-add {
            background: linear-gradient(45deg, var(--secondary-color), var(--primary-color));
            color: white;
        }

        .btn-pdf {
            background: var(--danger-color);
            color: var(--bg-dark);
            width: 100%;
            margin-top: 20px;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            overflow: hidden;
        }
        
        th, td {
            border: 1px solid var(--border-color);
            padding: 12px 15px;
            text-align: left;
        }
        
        th {
            background-color: var(--bg-dark);
            color: var(--primary-color);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85em;
            letter-spacing: 0.5px;
        }
        
        tbody tr { background-color: var(--bg-light); }
        .total-row td { text-align: right; color: var(--danger-color); font-weight: 600; }
        
        hr {
            border: none;
            border-top: 1px solid var(--border-color);
            margin: 40px 0;
        }
        
        @media (max-width: 768px) {
            body { padding: 10px; }
            .container { padding: 20px; }
            .form-grid { grid-template-columns: 1fr; gap: 15px; }
            h2 { font-size: 1.5em; }
            table { display: block; overflow-x: auto; white-space: nowrap; }
        }
    </style>
</head>
<body>

<div class="container">
    <h2><span role="img" aria-label="info">‚ÑπÔ∏è</span> Informasi Penawaran</h2>
    <div class="form-grid">
        <div class="form-group">
            <label for="quoId">ID Penawaran</label>
            <input type="text" id="quoId" placeholder="TSB/QUO/2207/...">
        </div>
        <div class="form-group">
            <label for="quoDate">Tanggal</label>
            <input type="text" id="quoDate" readonly>
        </div>
        <div class="form-group">
            <label for="senderPhone">Phone (Perusahaan)</label>
            <input type="text" id="senderPhone" value="0851-0078-1688" readonly>
        </div>
        <div class="form-group">
            <label for="senderEmail">Email (Perusahaan)</label>
            <input type="text" id="senderEmail" value="tsbmarketing19@gmail.com" readonly>
        </div>
    </div>
    
    <h2><span role="img" aria-label="client">üë§</span> Data Klien</h2>
    <div class="form-grid">
        <div class="form-group">
            <label for="clientCompany">PT / Perusahaan</label>
            <input type="text" id="clientCompany" placeholder="PT. STARNUSA">
        </div>
        <div class="form-group">
            <label for="clientName">Atas Nama (Attn)</label>
            <input type="text" id="clientName" placeholder="Ibu Rita">
        </div>
        <div class="form-group">
            <label for="clientPhone">Phone (Klien)</label>
            <input type="text" id="clientPhone" placeholder="0857-5459-0024">
        </div>
    </div>

    <hr>

    <h2><span role="img" aria-label="calculator">‚öôÔ∏è</span> Kalkulator Harga Jual</h2>
    <div class="form-grid">
        <div class="form-group">
            <label for="modal">Modal (Rp)</label>
            <input type="number" id="modal" placeholder="15500000">
        </div>
        <div class="form-group">
            <label for="ongkir">Ongkir (Rp)</label>
            <input type="number" id="ongkir" placeholder="50000">
        </div>
        <div class="form-group">
            <label for="profitPercentage">Profit</label>
            <div class="input-group">
                <input type="number" id="profitPercentage" value="12" step="0.1">
                <span class="input-group-text">%</span>
            </div>
        </div>
        <div class="form-group">
            <label for="hargaJual">Harga Jual (Rp)</label>
            <input type="text" id="hargaJual" class="price-display" readonly>
        </div>
    </div>

    <hr>

    <h2><span role="img" aria-label="document">üìã</span> Detail Barang</h2>
    <div class="form-grid">
        <div class="form-group">
            <label for="description">Description</label>
            <input type="text" id="description" placeholder="AS SS304">
        </div>
        <div class="form-group">
            <label for="size">Size</label>
            <input type="text" id="size" placeholder="4&quot; x 6m">
        </div>
        <div class="form-group">
            <label for="qty">QTY</label>
            <input type="number" id="qty" value="1">
        </div>
        <div class="form-group">
            <label for="unit">Unit</label>
            <select id="unit">
                <option>BTG</option>
                <option>Lmbr</option>
                <option>Pcs</option>
            </select>
        </div>
        <div class="form-group">
            <label for="ketersediaan">Ketersediaan</label>
            <select id="ketersediaan">
                <option>Ready</option>
                <option>Indent</option>
            </select>
        </div>
        <div class="form-group">
            <label for="berat">Berat (KG)</label>
            <input type="number" id="berat" placeholder="384">
        </div>
    </div>
    <button onclick="addItem()" class="btn-add">Tambah ke Penawaran</button>

    <table id="quotationTable">
        <thead>
            <tr>
                <th>Description</th>
                <th>Size</th>
                <th>QTY</th>
                <th>Unit</th>
                <th>Ketersediaan</th>
                <th>Berat/KG</th>
                <th>Price</th>
                <th>Total</th>
            </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
            <tr class="total-row">
                <td colspan="7">Subtotal</td>
                <td id="subtotal">Rp 0</td>
            </tr>
        </tfoot>
    </table>

    <hr>
    
    <h2><span role="img" aria-label="options">‚öôÔ∏è</span> Opsi PDF</h2>
     <div class="form-grid">
        <div class="form-group">
            <label for="payment">Payment</label>
            <select id="payment">
                <option>Cash</option>
                <option>DP</option>
                <option>Cash Before Delivery</option>
            </select>
        </div>
         <div class="form-group">
            <label for="delivery">Delivery</label>
            <input type="text" id="delivery" value="Indent ¬± 2 Minggu setelah PO">
        </div>
    </div>
    
    <button onclick="generatePDF()" class="btn-pdf">Cetak Penawaran ke PDF</button>

</div>

<script>
    const modalInput = document.getElementById('modal');
    const ongkirInput = document.getElementById('ongkir');
    const profitInput = document.getElementById('profitPercentage');
    const hargaJualInput = document.getElementById('hargaJual');
    const quotationItems = [];

    // Set tanggal hari ini
    window.onload = function() {
        const today = new Date();
        const day = String(today.getDate()).padStart(2, '0');
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const year = today.getFullYear();
        document.getElementById('quoDate').value = `${day}/${month}/${year}`;
        // Set ID default
        document.getElementById('quoId').value = `TSB/QUO/${day}${month}/${String(year).slice(-2)}`;
    };

    function formatRupiah(angka) {
        return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(angka);
    }

    function calculateSellingPrice() {
        const modal = parseFloat(modalInput.value) || 0;
        const ongkir = parseFloat(ongkirInput.value) || 0;
        
        if (modal === 0) {
            hargaJualInput.value = '';
            return;
        }

        const profitValue = parseFloat(profitInput.value) || 0;
        const profitPercentage = profitValue / 100;
        const subtotal = modal + ongkir;
        const profitAmount = subtotal * profitPercentage;
        const total = subtotal + profitAmount;
        
        const roundedTotal = Math.ceil(total / 1000) * 1000;
        
        hargaJualInput.value = formatRupiah(roundedTotal);
    }

    modalInput.addEventListener('input', calculateSellingPrice);
    ongkirInput.addEventListener('input', calculateSellingPrice);
    profitInput.addEventListener('input', calculateSellingPrice);

    function addItem() {
        const priceString = hargaJualInput.value.replace(/[^0-9]/g, '');
        const price = parseFloat(priceString) || 0;

        if (price === 0) {
            alert('Harap hitung Harga Jual terlebih dahulu (isi Modal).');
            return;
        }

        const item = {
            description: document.getElementById('description').value,
            size: document.getElementById('size').value,
            qty: parseInt(document.getElementById('qty').value) || 1,
            unit: document.getElementById('unit').value,
            ketersediaan: document.getElementById('ketersediaan').value,
            berat: parseFloat(document.getElementById('berat').value) || 0,
            price: price
        };
        
        item.total = item.qty * item.price;
        quotationItems.push(item);
        
        updateTable();
        clearInputFields();
    }

    function updateTable() {
        const tableBody = document.querySelector("#quotationTable tbody");
        tableBody.innerHTML = '';
        let subtotal = 0;

        quotationItems.forEach(item => {
            const row = tableBody.insertRow();
            row.innerHTML = `
                <td>${item.description}</td>
                <td>${item.size}</td>
                <td>${item.qty}</td>
                <td>${item.unit}</td>
                <td>${item.ketersediaan}</td>
                <td>${item.berat}</td>
                <td>${formatRupiah(item.price)}</td>
                <td>${formatRupiah(item.total)}</td>
            `;
            subtotal += item.total;
        });

        document.getElementById('subtotal').innerText = formatRupiah(subtotal);
    }
    
    function clearInputFields() {
        document.getElementById('description').value = '';
        document.getElementById('size').value = '';
        document.getElementById('qty').value = '1';
        document.getElementById('berat').value = '';
        document.getElementById('description').focus();
    }

    function generatePDF() {
        try {
            if (quotationItems.length === 0) {
                alert('Tidak ada item dalam penawaran untuk dicetak.');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Ambil semua data dari form
            const quoId = document.getElementById('quoId').value;
            const quoDate = document.getElementById('quoDate').value;
            const senderPhone = document.getElementById('senderPhone').value;
            const senderEmail = document.getElementById('senderEmail').value;
            const clientCompany = document.getElementById('clientCompany').value || "-";
            const clientName = document.getElementById('clientName').value || "-";
            const clientPhone = document.getElementById('clientPhone').value || "-";

            // Header Kiri (Info Perusahaan Anda)
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(14);
            doc.text("PT. TIMUR SUKSES BAJATAMA", 14, 20);
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(9);
            doc.text("Jl. Untung Suropati Komp. Mahakam Square Blok C.10", 14, 26);
            doc.text("Samarinda, Kalimantan Timur", 14, 30);

            // Header Kanan (Info Penawaran)
            doc.setFontSize(10);
            const rightAlign = 196;
            doc.text("QUOTATION", rightAlign, 20, { align: 'right' });
            doc.text(`ID: ${quoId}`, rightAlign, 30, { align: 'right' });
            doc.text(`Date: Samarinda, ${quoDate}`, rightAlign, 35, { align: 'right' });
            doc.text(`Phone: ${senderPhone}`, rightAlign, 40, { align: 'right' });
            doc.text(`Email: ${senderEmail}`, rightAlign, 45, { align: 'right' });
            
            // Data Klien
            doc.line(14, 55, 196, 55); // Garis pemisah
            doc.setFont('helvetica', 'bold');
            doc.text("Kepada Yth:", 14, 62);
            doc.setFont('helvetica', 'normal');
            doc.text(clientCompany, 14, 68);
            doc.text(`Attn: ${clientName}`, 14, 73);
            doc.text(`Phone: ${clientPhone}`, 14, 78);
            
            // Tabel Data Barang
            const tableData = quotationItems.map(item => [
                item.description, item.size, item.qty, item.unit, item.ketersediaan,
                item.berat,
                formatRupiah(item.price).replace(/Rp\s?/, ''),
                formatRupiah(item.total).replace(/Rp\s?/, '')
            ]);
            const subtotal = quotationItems.reduce((sum, item) => sum + item.total, 0);
            tableData.push([
                { content: 'Subtotal', colSpan: 7, styles: { halign: 'right', fontStyle: 'bold' } },
                { content: formatRupiah(subtotal).replace(/Rp\s?/, ''), styles: { halign: 'right', fontStyle: 'bold' } }
            ]);

            doc.autoTable({
                startY: 85,
                head: [['Description', 'Size', 'QTY', 'Unit', 'Ketersediaan', 'Berat/KG', 'Price', 'Total']],
                body: tableData,
                theme: 'grid',
                headStyles: { fillColor: [44, 58, 71], font: 'helvetica', fontStyle: 'bold' },
                styles: { font: 'helvetica', fontSize: 9, cellPadding: 2 },
                columnStyles: { 6: { halign: 'right' }, 7: { halign: 'right' } }
            });

            // Footer (Notes, Delivery, Payment)
            let finalY = doc.lastAutoTable.finalY + 10;
            const paymentMethod = document.getElementById('payment').value;
            const deliveryInfo = document.getElementById('delivery').value;
            
            doc.setFontSize(9);
            doc.setFont('helvetica', 'bold');
            doc.text("Note:", 14, finalY);
            doc.setFont('helvetica', 'normal');
            doc.text("- Harga Franco Kota Samarinda", 25, finalY);
            doc.text("- Harga sudah termasuk PPN", 25, finalY + 4);
            
            finalY += 12;
            
            doc.setFont('helvetica', 'bold');
            doc.text("Delivery:", 14, finalY);
            doc.setFont('helvetica', 'normal');
            doc.text(deliveryInfo, 35, finalY);

            finalY += 5;
            
            doc.setFont('helvetica', 'bold');
            doc.text("Payment:", 14, finalY);
            doc.setFont('helvetica', 'normal');
            doc.text(paymentMethod, 35, finalY);

            // Tanda Tangan
            finalY += 15;
            doc.text("Hormat Kami,", 14, finalY);
            doc.text("PT. TIMUR SUKSES BAJATAMA", 14, finalY + 20);

            doc.save(`Quotation-${clientCompany.replace(/[\.\s]/g,"_")}-${quoDate.replace(/\//g,"-")}.pdf`);

        } catch (error) {
            console.error("Gagal membuat PDF:", error);
            alert("Terjadi kesalahan saat membuat PDF. Silakan periksa console browser untuk detailnya.");
        }
    }

</script>

</body>
</html>
