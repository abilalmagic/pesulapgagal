<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Card Camera</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background-color: #000; 
            font-family: Arial, sans-serif; 
            display: flex; justify-content: center; align-items: center; 
            height: 100vh; overflow: hidden; color: white;
        }

        /* Container utama mengikuti aspek rasio HP */
        .app-container {
            width: 100%; max-width: 450px; height: 100%;
            background: #000; position: relative; display: flex; flex-direction: column;
        }

        /* Top Bar */
        .top-bar {
            display: flex; justify-content: space-between; padding: 20px;
            font-size: 18px; z-index: 10;
        }

        /* Area Kamera */
        .viewport {
            flex: 1; position: relative; display: flex; justify-content: center; align-items: center;
            background: #111; overflow: hidden;
        }

        #webcam { width: 100%; height: 100%; object-fit: cover; }
        
        /* Gambar Hasil AI & Overlay */
        #result-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: none;
            flex-direction: column; justify-content: center; align-items: center; z-index: 20;
        }

        #ai-image { width: 80%; border-radius: 10px; border: 2px solid white; display: none; }
        
        .timer-text { font-size: 48px; font-weight: bold; margin-bottom: 20px; }
        .status-text { color: #aaa; margin-top: 10px; }

        /* Bottom Controls */
        .bottom-bar {
            padding: 30px 0; display: flex; flex-direction: column; align-items: center;
            background: black;
        }

        .modes { display: flex; gap: 15px; margin-bottom: 25px; color: #888; font-size: 13px; text-transform: uppercase; }
        .modes .active { color: #ffcc00; font-weight: bold; }

        .shutter-row { display: flex; align-items: center; gap: 40px; }
        
        .circle-btn { width: 45px; height: 45px; border: 2px solid white; border-radius: 50%; }
        
        .shutter-btn {
            width: 75px; height: 75px; background: white; border-radius: 50%;
            border: 5px solid #333; cursor: pointer; transition: 0.2s;
        }
        .shutter-btn:active { transform: scale(0.9); background: #ddd; }

        .flip-btn { 
            width: 45px; height: 45px; border-radius: 50%; background: #222; 
            display: flex; justify-content: center; align-items: center; cursor: pointer;
        }
    </style>
</head>
<body>

<div class="app-container">
    <div class="top-bar">
        <span>âš¡</span> <span>HDR</span> <span>ðŸ‘¤</span> <span>â‰¡</span>
    </div>

    <div class="viewport">
        <video id="webcam" autoplay playsinline></video>
        
        <div id="result-overlay">
            <div class="timer-text" id="countdown">60 ss</div>
            <img id="ai-image" src="" alt="AI Generated Card">
            <p class="status-text" id="status-msg">Menganalisa Kartu...</p>
            <button onclick="resetCamera()" style="margin-top:20px; padding:10px; background:white; border:none; border-radius:5px; display:none;" id="btn-reset">Ambil Ulang</button>
        </div>
    </div>

    <div class="bottom-bar">
        <div class="modes">
            <span>Video</span> <span class="active">Photo</span> <span>Portrait</span> <span>Square</span>
        </div>
        <div class="shutter-row">
            <div class="circle-btn"></div>
            <div class="shutter-btn" onclick="takeAction()"></div>
            <div class="flip-btn" onclick="flipCamera()">ðŸ”„</div>
        </div>
    </div>
</div>

<canvas id="hidden-canvas" style="display:none;"></canvas>

<script>
    const video = document.getElementById('webcam');
    const overlay = document.getElementById('result-overlay');
    const aiImage = document.getElementById('ai-image');
    const countdownEl = document.getElementById('countdown');
    const statusEl = document.getElementById('status-msg');
    const btnReset = document.getElementById('btn-reset');
    
    let currentFacingMode = "environment";
    let stream;

    // Aktifkan Kamera
    async function startCamera() {
        if (stream) stream.getTracks().forEach(track => track.stop());
        try {
            stream = await navigator.mediaDevices.getUserMedia({
                video: { facingMode: currentFacingMode }
            });
            video.srcObject = stream;
        } catch (err) {
            alert("Izin kamera ditolak atau tidak ditemukan.");
        }
    }

    function flipCamera() {
        currentFacingMode = currentFacingMode === "user" ? "environment" : "user";
        startCamera();
    }

    function takeAction() {
        // Tampilkan Overlay & Mulai Simulasi
        overlay.style.display = 'flex';
        aiImage.style.display = 'none';
        btnReset.style.display = 'none';
        statusEl.innerText = "Mendeteksi Kartu 2 Keriting...";
        
        let timeLeft = 60;
        countdownEl.innerText = timeLeft + " ss";

        const timer = setInterval(() => {
            timeLeft--;
            countdownEl.innerText = timeLeft + " ss";

            if (timeLeft === 55) {
                statusEl.innerText = "Mengubah Objek via AI...";
            }

            if (timeLeft <= 0) {
                clearInterval(timer);
                showResult();
            }
        }, 1000);
    }

    function showResult() {
        // Menggunakan Pollinations API untuk generate gambar kartu 2 Hati
        // Kita beri prompt spesifik agar hasilnya sesuai keinginan
        const randomSeed = Math.floor(Math.random() * 1000);
        const prompt = "a hand holding a 2 of hearts playing card, highly realistic, cinematic lighting, extreme detail";
        const aiUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?seed=${randomSeed}&width=500&height=700&nologo=true`;

        countdownEl.innerText = "BERHASIL!";
        statusEl.innerText = "Kartu telah berubah menjadi 2 Hati";
        aiImage.src = aiUrl;
        aiImage.style.display = 'block';
        btnReset.style.display = 'block';
    }

    function resetCamera() {
        overlay.style.display = 'none';
        startCamera();
    }

    // Jalankan kamera saat pertama buka
    startCamera();
</script>

</body>
</html>
