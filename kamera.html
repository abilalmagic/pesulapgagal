<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Magic Morph</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #000; font-family: sans-serif; height: 100vh; overflow: hidden; color: white; }

        /* Setup Menu */
        #setup-menu {
            position: fixed; inset: 0; background: #1a1a1a; z-index: 100;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        select, button { padding: 15px; width: 80%; margin: 10px; border-radius: 10px; border: none; }
        button { background: #ffcc00; font-weight: bold; }

        /* Viewport */
        .viewport { flex: 1; position: relative; background: #000; display: flex; justify-content: center; align-items: center; height: calc(100vh - 150px); }
        #webcam { width: 100%; height: 100%; object-fit: cover; }
        
        /* Layer Foto */
        .result-layer {
            position: absolute; inset: 0; display: none;
            justify-content: center; align-items: center; background: black;
        }
        
        /* Foto Asli (Bawah) */
        #original-snap { width: 100%; height: 100%; object-fit: cover; position: absolute; z-index: 10; }
        
        /* Foto AI (Atas) */
        #ai-morph { 
            width: 100%; height: 100%; object-fit: cover; position: absolute; 
            z-index: 20; opacity: 0; 
            transition: opacity 3s ease-in-out; /* Transisi halus 3 detik */
        }

        /* UI Kamera */
        .bottom-bar { height: 150px; background: black; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .shutter-btn { width: 70px; height: 70px; background: white; border-radius: 50%; border: 5px solid #333; }
    </style>
</head>
<body>

<div id="setup-menu">
    <h3>Setting Kartu Target</h3>
    <select id="card-select">
        <option value="2 of hearts">2 Hati (2 of Hearts)</option>
        <option value="ace of spades">As Sekop (Ace of Spades)</option>
        <option value="king of diamonds">King Wajik (King of Diamonds)</option>
    </select>
    <button onclick="initApp()">BUKA KAMERA</button>
</div>

<div class="viewport">
    <video id="webcam" autoplay playsinline></video>
    
    <div id="result-layer" class="result-layer">
        <canvas id="original-snap"></canvas>
        <img id="ai-morph" src="" alt="AI Result">
    </div>
</div>

<div class="bottom-bar">
    <div class="shutter-btn" onclick="captureMagic()"></div>
</div>

<script>
    let targetCard = "";
    const video = document.getElementById('webcam');
    const resultLayer = document.getElementById('result-layer');
    const originalSnap = document.getElementById('original-snap');
    const aiMorph = document.getElementById('ai-morph');
    const ctx = originalSnap.getContext('2d');

    async function initApp() {
        targetCard = document.getElementById('card-select').value;
        document.getElementById('setup-menu').style.display = 'none';
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
        video.srcObject = stream;
    }

    function captureMagic() {
        // 1. Ambil foto asli dan tampilkan di canvas
        originalSnap.width = video.videoWidth;
        originalSnap.height = video.videoHeight;
        ctx.drawImage(video, 0, 0);
        
        // Tampilkan layer hasil (masih foto asli)
        resultLayer.style.display = 'flex';
        aiMorph.style.opacity = "0"; // Pastikan AI masih transparan

        // 2. Siapkan gambar AI di background
        const seed = Math.floor(Math.random() * 1000);
        // Kita gunakan prompt yang mirip dengan komposisi foto pada umumnya
        const prompt = `a hand holding a ${targetCard} playing card, first person view, realistic photography, match lighting`;
        const aiUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?seed=${seed}&width=${video.videoWidth}&height=${video.videoHeight}&nologo=true`;
        
        aiMorph.src = aiUrl;

        // 3. Logika Perubahan (Tunggu 5 detik, lalu munculkan AI pelan-pelan)
        setTimeout(() => {
            // Morphing dimulai: Foto AI perlahan menutupi foto asli
            aiMorph.style.opacity = "1";
        }, 5000); // 5 detik setelah jepret
    }

    // Klik layar untuk kembali ke kamera
    resultLayer.onclick = () => {
        resultLayer.style.display = 'none';
        aiMorph.style.opacity = "0";
    };
</script>
</body>
</html>
