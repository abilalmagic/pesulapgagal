<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Magic AI Invisibility</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #000; font-family: sans-serif; height: 100vh; overflow: hidden; }

        /* Setup awal */
        #setup {
            position: fixed; inset: 0; background: #111; z-index: 100;
            display: flex; flex-direction: column; align-items: center; justify-content: center; color: white;
        }
        select, button { padding: 15px; width: 80%; margin: 10px; border-radius: 12px; border: none; font-size: 16px; }
        button { background: #4285f4; color: white; font-weight: bold; }

        .viewport { position: relative; width: 100vw; height: 80vh; background: #000; }
        #webcam { width: 100%; height: 100%; object-fit: cover; }
        
        /* Layer utama untuk hasil */
        #display-container {
            position: absolute; inset: 0; display: none; z-index: 50;
            cursor: pointer; background: black;
        }

        /* Foto final yang sudah digabung (Bisa di save) */
        #final-render {
            width: 100%; height: 100%; object-fit: contain;
            opacity: 0; transition: opacity 2s ease-in-out;
        }

        /* Bottom UI */
        .bottom-bar { height: 20vh; background: black; display: flex; align-items: center; justify-content: center; }
        .shutter { width: 70px; height: 70px; background: white; border-radius: 50%; border: 5px solid #333; }
    </style>
</head>
<body>

<div id="setup">
    <h2>Magic Card AI</h2>
    <p>Kartu target:</p>
    <select id="card-choice">
        <option value="ace_of_spades">As Sekop (Ace of Spades)</option>
        <option value="2_of_hearts">2 Hati (2 of Hearts)</option>
        <option value="king_of_diamonds">King Wajik (King of Diamonds)</option>
    </select>
    <button onclick="startApp()">MASUK KAMERA</button>
</div>

<div class="viewport">
    <video id="webcam" autoplay playsinline></video>
    <div id="display-container" onclick="reset()">
        <img id="final-render" alt="Hasil Magic">
    </div>
</div>

<div class="bottom-bar">
    <div class="shutter" onclick="shoot()"></div>
</div>

<canvas id="proc-canvas" style="display:none;"></canvas>

<script>
    const video = document.getElementById('webcam');
    const container = document.getElementById('display-container');
    const finalImg = document.getElementById('final-render');
    const procCanvas = document.getElementById('proc-canvas');
    const ctx = procCanvas.getContext('2d');
    let target = "";

    async function startApp() {
        target = document.getElementById('card-choice').value;
        document.getElementById('setup').style.display = 'none';
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
        video.srcObject = stream;
    }

    function shoot() {
        // 1. Ambil foto asli
        procCanvas.width = video.videoWidth;
        procCanvas.height = video.videoHeight;
        ctx.drawImage(video, 0, 0);
        
        // Tampilkan foto asli dulu agar user tidak curiga
        const originalData = procCanvas.toDataURL('image/jpeg');
        finalImg.src = originalData;
        finalImg.style.opacity = "1";
        container.style.display = 'block';

        // 2. Siapkan kartu AI secara rahasia
        const aiCard = new Image();
        const seed = Math.floor(Math.random() * 999);
        const prompt = `playing_card_${target}_realistic_white_background`;
        aiCard.crossOrigin = "anonymous";
        aiCard.src = `https://image.pollinations.ai/prompt/${prompt}?seed=${seed}&width=400&height=600&nologo=true`;

        aiCard.onload = () => {
            // 3. Gabungkan AI ke foto asli di background (Clipping)
            // Kita gambar ulang foto asli ke canvas
            ctx.drawImage(video, 0, 0);
            
            // Tentukan area kartu (tengah layar)
            const cw = procCanvas.width * 0.35;
            const ch = cw * 1.45;
            const cx = (procCanvas.width - cw) / 2;
            const cy = (procCanvas.height - ch) / 2;

            // Efek Inpainting: Kita tempel kartu AI dengan pinggiran yang sangat halus (soft edges)
            ctx.save();
            // Membuat bayangan halus di sekitar kartu agar menyatu
            ctx.shadowBlur = 15;
            ctx.shadowColor = "black";
            // Tempel kartu AI tepat di atas kartu asli
            ctx.drawImage(aiCard, cx, cy, cw, ch);
            ctx.restore();

            const mergedData = procCanvas.toDataURL('image/jpeg');

            // 4. Detik ajaib: Ganti foto asli dengan foto yang sudah "dimodifikasi"
            setTimeout(() => {
                finalImg.src = mergedData; 
                // Karena src diganti, transisi terjadi secara halus di mata user
            }, 5000); 
        };
    }

    function reset() {
        container.style.display = 'none';
        finalImg.style.opacity = "0";
    }
</script>
</body>
</html>
